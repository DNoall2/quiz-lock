import{_ as D,C as O,j as U,i as a,h as $,G as S,c as u,o as i,q as l,v as p,t as V,F as E,B as L,x as Q,b as K,H as j,y as F,I as G,J as H,D as J,E as W}from"./settingsStorage-C0E3b7K0.js";const P={class:"blocked-page"},X=["disabled"],Y={key:0},Z={key:0},ee=["value"],oe={key:1,class:"short-answer-input"},te=["onKeyup"],ne={key:2},le={key:1},se={class:"unblock-timer"},ae={__name:"Blocked",setup(ie){const{quizzes:b}=O(),{settings:_,settingsReady:I}=J();U(I,e=>{e&&x()}),U(b,e=>{e&&e.length>0&&k()});const r=a(null),d=a([]),c=a(""),h=a(null),f=a(!1),m=a(0),v=a(0),y=a(0),w=a([]),q=$(()=>b.value.filter(e=>e.enabled));function k(){if(q.value.length===0){r.value=null,d.value=[];return}const e=q.value.filter(s=>{var g;return(g=s.data)==null?void 0:g.some(B=>!w.value.includes(B.question))});if(e.length===0){console.log("[Blocked] No quizzes with unasked questions found"),r.value=null,d.value=[];return}const o=e[Math.floor(Math.random()*e.length)],t=o.data.filter(s=>!w.value.includes(s.question));if(t.length===0){console.log(`[Blocked] No unasked questions found for quiz ${o.name}`),w.value=[];return}const n=t[Math.floor(Math.random()*t.length)];w.value.push(n.question),r.value=n,d.value=n.choices||[]}function N(){const e="CodexArcana",o=r.value.file;console.log(`[Blocked] Opening ${o} in Obsidian`);const t=`obsidian://open?vault=${encodeURIComponent(e)}&file=${encodeURIComponent(o)}`;window.location.href=t}function C(){if(!d.value||!c.value){h.value=null;return}const e=c.value.toLowerCase()===r.value.answer.toLowerCase();if(h.value=e,e){y.value+=1;const o=_.value.numberOfQuestions;y.value>=o?browser.storage.local.get(["blockedUrl","temporarilyAllowed","sites"]).then(t=>{const n=t.blockedUrl,s=t.temporarilyAllowed||[],g=t.sites||[];console.log("[Blocked] Redirecting to:",n);const B=new URL(n).hostname,A=g.find(z=>typeof z=="object"&&B.includes(z.name)),R=(A.hours||0)*60*60+(A.minutes||0)*60,T=Date.now()+R*1e3;s.push({url:n,expiresAt:T}),browser.storage.local.set({temporarilyAllowed:s}).then(()=>{window.location.href=n})}):(c.value="",k())}}function M(){const e=_.value.newQuestionButtonCountdownSeconds;k(),f.value=!0,m.value=e;const o=setInterval(()=>{m.value-=1,m.value<=0&&(clearInterval(o),f.value=!1)},1e3)}function x(){const e=_.value.unblockDurationMinutes*60;v.value=e,console.log(`[Blocked] Unblock timer started with wait time: ${e} seconds`);const o=setInterval(()=>{v.value-=1,v.value<=0&&(clearInterval(o),v.value=0,browser.storage.local.get(["blockedUrl","temporarilyAllowed"]).then(t=>{const n=t.blockedUrl,s=t.temporarilyAllowed||[];console.log("[Blocked] Redirecting to:",n),s.push(n),browser.storage.local.set({temporarilyAllowed:s}).then(()=>{window.location.href=n})}))},1e3)}return S(()=>{y.value=0,w.value=[],b.value.length>0&&k()}),(e,o)=>(i(),u("div",P,[o[3]||(o[3]=l("h1",null,"Blocked",-1)),l("button",{disabled:f.value,onClick:M},p(f.value?`Wait ${m.value} seconds`:"New Question"),9,X),l("button",{onClick:N},"View in Obsidian"),r.value?(i(),u("div",Y,[l("h2",null,p(r.value.question),1),d.value.length?(i(),u("ul",Z,[(i(!0),u(E,null,L(d.value,(t,n)=>(i(),u("li",{key:n},[l("label",null,[Q(l("input",{type:"radio",value:t,"onUpdate:modelValue":o[0]||(o[0]=s=>c.value=s),name:"quiz-options",onChange:C},null,40,ee),[[j,c.value]]),K(" "+p(t),1)])]))),128))])):(i(),u("div",oe,[l("span",null,[Q(l("input",{type:"text","onUpdate:modelValue":o[1]||(o[1]=t=>c.value=t),placeholder:"Enter your answer",onKeyup:G(H(C,["prevent"]),["enter"])},null,40,te),[[F,c.value]]),l("button",{onClick:C},"Check Answer")])])),h.value!==null?(i(),u("p",ne,p(h.value?"Correct!":"Incorrect. Try again."),1)):V("",!0)])):(i(),u("div",le,o[2]||(o[2]=[l("h2",null,"No quizzes available",-1)]))),l("div",se,[l("h2",null,"Unblock in: "+p(v.value),1)])]))}},ue=D(ae,[["__scopeId","data-v-a2d87971"]]);W(ue).mount("#app");
